<?xml version='1.0' encoding='UTF-8'?>

<synthetic xsi:schemaLocation="http://www.xebialabs.com/deployit/synthetic synthetic.xsd"
           xmlns="http://www.xebialabs.com/deployit/synthetic" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

    <type type="servicenow.Server" label="ServiceNow: Server" extends="configuration.HttpConnection">
        <property name="scriptLocation" default="servicenow/check_connection.py" hidden="true"/>
        <property name="changeRecordTableName" label="Change Record Table Name (Required for Generate Release)"
                  required="false" hidden="true" default="change_request"/>
        <property name="changeTaskTableName" label="Change Task Table Name (Required for Generate Release)"
                  required="false" hidden="true" default="change_task"/>
        <property name="sysparmDisplayValue" label="Retrieve display value" required="false" default="False" kind="boolean" description="If true returns display values for all of the fields"/>
        <property name="sysparmInputDisplayValue" label="Input values are display values" required="true" default="True" hidden="true"
                  kind="boolean" description="If true treats input values as display values"/>
        <property name="useOAuth" label="Use ServiceNow OAuth Resource Server"
                  description="Use OAuth instead of basic authentication" required="false" category="OAuth"
                  kind="boolean"/>
        <property name="oauthUsername" label="Username" description="Mandatory if OAuth is enabled" required="false"
                  category="OAuth"/>
        <property name="oauthPassword" label="Password" description="Mandatory if OAuth is enabled" required="false"
                  password="true" category="OAuth"/>
        <property name="clientId" label="Client Id" description="Mandatory if OAuth is enabled" required="false"
                  category="OAuth"/>
        <property name="clientSecret" label="Client Secret" description="Mandatory if OAuth is enabled" required="false"
                  password="true" category="OAuth"/>
    </type>
    
    <!--
       #######################################################################################################################
       #    Basic fields for all types (Servicenow Base)
       #    Basic task operations with standard task fields.
       #######################################################################################################################
   -->    
    
    <type type="servicenow.Base" extends="xlrelease.PythonScript" virtual="true">
        <property name="iconLocation" default="servicenow/servicenow-icon.png" hidden="true"/>
        <property name="servicenowServer" category="input" label="Server" referenced-type="servicenow.Server" required="true"
                  kind="ci"/>
        <property name="username" category="input" required="false"/>
        <property name="password" password="true" category="input" required="false"/>
        <property name="data" category="output" kind="map_string_string"/>
    </type>
    

    <type type="servicenow.CreateTask" extends="servicenow.Base" label="ServiceNow: Create Task" virtual="true">
        <property name="scriptLocation" default="servicenow/task/create_task.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="task" required="true"
                  hidden="true"/>
        <property name="sysId" category="input" required="true"/>
        <property name="shortDescription" category="input" label="Short Description"/>
        <property name="description" category="input" size="large" label="Description" required="false"/>
        <property name="ciSysId" category="input" label="Configuration Item" description="Related CMDB Configuration Item Id" required="false"/>
        <property name="assignmentGroup" category="input" required="false"/>
        <property name="assignedTo" category="input" required="false"/>
        <property name="state" category="input" required="false" kind="enum">
            <enum-values>
                <value>Pending</value>
                <value>New</value>
                <value>Assess</value>
                <value>In Progress</value>
                <value>Implement</value>
                <value>Closed</value>
            </enum-values>
        </property>
        <property name="priority" category="input" required="false" kind="enum">
            <enum-values>
                <value>1 - Critical</value>
                <value>2 - High</value>
                <value>3 - Moderate</value>
                <value>4 - Low</value>
            </enum-values>
        </property>
        <property name="comments" category="input" label="Comments" required="false"/>
        <property name="additionalFields" category="input" required="false" description="Use Servicenow technical field name as 'key' and the corresponding value" kind="map_string_string"/>
        
        <!-- Next 3 lines need to be removed -->
        <property name="content" category="input" label="Content" default="x" size="large" hidden="true"/>
        <property name="taskId" category="output" default="x" hidden="true"/>
        <property name="Task" category="output" default="x" hidden="true"/>
        <!--end-->
        
        <property name="sysId" category="output" default="${sysId}"/>
        <property name="number" category="output" default="${newNumber}"/>
    </type>

    <type type="servicenow.UpdateTask" extends="servicenow.CreateTask" label="ServiceNow: Update Task" virtual="true">
        <property name="scriptLocation" default="servicenow/task/update_task.py" hidden="true"/>
        <property name="shortDescription" category="input" label="Short Description" required="false"/>
        <property name="sysId" category="input" default="${sysId}" required="true"/>
    </type>
    
    
    <type type="servicenow.FindRecordByTicket" extends="servicenow.Base" label="ServiceNow: Find Record by Number" virtual="true">
        <property name="scriptLocation" default="servicenow/find_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="task" required="true"
                  hidden="true"/>
        <property name="number" category="input" default="${newNumber}" required="true"/>
        <property name="sysId" category="output"/>
    </type>
    
    <type type="servicenow.PollingCheckStatus" extends="servicenow.Base" label="ServiceNow: Wait for Status" virtual="false">
        <property name="scriptLocation" default="servicenow/task/poll_status.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="false"/>
        <property name="sysId" category="input" default="${sysId}" label="System ID" required="true"/>
        <property name="pollInterval" category="input" kind="integer" label="Polling Interval" required="true" description="polling interval in minutes."
                  default="10"/>
        <property name="statusField" category="input" label="Status Field" required="true" default="state"/>
        <property name="checkForStatus" category="input" label="Status to check for" required="true"/>
        <property name="status" category="output"/>
        <property name="ticket" category="output"/>
        <property name="data" category="output" kind="map_string_string"/>
    </type>

    <!--
       #######################################################################################################################
       #    Change Requests
       #######################################################################################################################
    -->
    <type type="servicenow.CreateChangeRequest" extends="servicenow.CreateTask" label="ServiceNow: Create Change Request" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="state" category="input" required="false" default="New" kind="enum">
            <enum-values>
                <value>New</value>
                <value>Assess</value>
            </enum-values>
        </property>
    </type>

    <type type="servicenow.UpdateChangeRequest" extends="servicenow.UpdateTask" label="ServiceNow: Update Change Request" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="state" category="input" required="false" kind="enum">
            <enum-values>
                <value>New</value>
                <value>Assess</value>
                <value>Implement</value>
                <value>Closed</value>
            </enum-values>
        </property>
    </type>

    <type type="servicenow.FindChangeRequestByTicket" extends="servicenow.FindRecordByTicket" label="ServiceNow: Find Change Request" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
    </type>


    <type type="servicenow.GetChangeRequest" extends="servicenow.Base" label="ServiceNow: Get Change Request" virtual="false">
        <property name="scriptLocation" default="servicenow/get_change_request.py" hidden="true"/>
        <property name="tableName" category="input" default="change_request" required="true" hidden="true"/>
        <property name="number" category="input" label="Number" default="${newNumber}" required="true"/>
        <property name="fieldNames" category="input" label="Field Names" required="true" kind="list_of_string"
                  description="List of field names to be displayed"/>
    </type>
    
    
    <!--
       #######################################################################################################################
       #    Change Request Tasks
       #######################################################################################################################
   -->
        
    <type type="servicenow.CreateChangeTask" extends="servicenow.CreateTask" label="ServiceNow: Create Change Task" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_task" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.UpdateChangeTask" extends="servicenow.UpdateTask"  label="ServiceNow: Update Change Task" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_task" required="true"
                  hidden="true"/>
        <property name="state" category="input" required="false" kind="enum">
            <enum-values>
                <value>Pending</value>
                <value>In Progress</value>
                <value>Closed</value>
            </enum-values>
        </property>
    </type>

    <type type="servicenow.FindChangeTaskByTaskId" extends="servicenow.FindRecordByTicket"  label="ServiceNow: Find Change Task" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_task" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindChangeTaskByParent" extends="servicenow.FindRecordByTicket"  label="ServiceNow: Find Change Task by Parent" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="change_task" required="true"
                  hidden="true"/>
        <property name="scriptLocation" default="servicenow/change/find_by_parent.py" hidden="true"/>
        <property name="shortDescription" category="input" description="Multiple tasks can exists provide short description to look for." label="Short Description" default="Implement" required="false"/>
        <property name="parent" category="input" required="true" default="${sysId}"/>
        <property name="sysId" category="output" default="${cTaskSysId}"/>
    </type>
    
    <!--
       #######################################################################################################################
       #    ServiceNow CMDB info.
       #######################################################################################################################
   -->
    
    <type type="servicenow.UpdateCMDB" extends="servicenow.Base" label="ServiceNow: Update CMDB">
        <property name="scriptLocation" default="servicenow/update_cmdb.py" hidden="true"/>
        <property name="tableName" category="input" default="cmdb_ci" required="true" hidden="true"/>
        <property name="environment" category="input" required="true" label="Environment"/>
        <property name="applicationName" category="input" required="true" label="Application Name"/>
        <property name="company" category="input" required="true" label="Company"/>
        <property name="version" category="input" required="true" label="Version"/>
        <property name="sysId" category="output"/>
    </type>

    <type type="servicenow.Application" extends="servicenow.Base" label="ServiceNow: Create Application">
        <property name="scriptLocation" default="servicenow/application/create_or_update_application.py" hidden="true"/>
        <property name="ciName" label="CI Name" category="input"/>
        <property name="environment" category="input" required="false"/>
        <property name="version" category="input" required="false"/>
        <property name="dependsOn" category="input" kind="set_of_string" required="false"/>
        <property name="usedBy" category="input" kind="set_of_string" required="false"/>
        <property name="runsOn" category="input" kind="set_of_string" required="false"/>
        <property name="sysId" category="output"/>
    </type>

    <type type="servicenow.UpdateApplicationVersion" extends="servicenow.Base" label="ServiceNow: Update Application Version">
        <property name="scriptLocation" default="servicenow/application/update_application_version.py" hidden="true"/>
        <property name="ciName" label="CI Name" category="input"/>
        <property name="environment" category="input" required="false"/>
        <property name="version" category="input" required="false"/>
    </type>

    <!--
     #######################################################################################################################
     #    ServiceNow Portal and KnowledgeBase
     #######################################################################################################################
    -->
    <type type="servicenow.PublishArticle" extends="servicenow.Base" label="ServiceNow: Publish Article">
        <property name="scriptLocation" default="servicenow/kb/create_or_update_article.py" hidden="true"/>
        <property name="articleCategory" category="input"/>
        <property name="knowledgeBase" category="input"/>
        <property name="shortDescription" category="input"/>
        <property name="articleText" category="input" size="large"/>
    </type>
    
    <!--
       #######################################################################################################################
       #    Incident Requests
       #######################################################################################################################
   -->
    
    <type type="servicenow.CreateIncident" extends="servicenow.CreateTask" label="ServiceNow: Create Incident" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.UpdateIncident" extends="servicenow.UpdateTask" label="ServiceNow: Update Incident" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindIncidentByTicket" extends="servicenow.FindRecordByTicket" label="ServiceNow: Find Incident" virtual="false">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>


    <!--
       #######################################################################################################################
       #    Tile
       #######################################################################################################################
   -->

    <type type="servicenow.ServiceNowQueryTile" label="ServiceNow: Service Now query tile" extends="xlrelease.Tile">
        <property name="uri" hidden="true" default="include/ServiceNowQueryTile/servicenow-query-summary-view.html"/>
        <property name="detailsUri" hidden="true"
                  default="include/ServiceNowQueryTile/servicenow-query-details-view.html"/>
        <property name="title" description="Tile title" default="ServiceNow tickets"/>
        <property name="embedded" kind="boolean" hidden="true" default="true"
                  required="false"/>
        <property category="input" name="servicenowServer" referenced-type="servicenow.Server" kind="ci" label="Server"
                  description="ServiceNow server id to connect to"/>
        <property category="input" name="username" required="false"
                  description="Overrides the username used to connect to the server"/>
        <property category="input" name="password" password="true" required="false"
                  description="Overrides the password used to connect to the server"/>
        <property category="input" name="authToken" required="false"
                  description="Overrides the auth token used to connect to the server" default="None" hidden="true"/>
        <property category="input" name="tableName" required="true" default="incident"
                  description="ServiceNow table name (in lower case) (for example problem, change_request etc) Default value: incident"/>
        <property category="input" name="query" required="false" size="large" description="ServiceNow query"/>
        <property category="input" name="detailsViewColumns" hidden="false" kind="map_string_string"
                  default="number:number,short_description:short_description,priority:priority,state:state,assigned_to:assigned_to.display_value"
                  description="Map of columns displayed in details view of tile. For a referenced type column, display_value should be in the value of key:value pair separated by . (eg. assigned_to:assigned_to.display_value)"/>
    </type>
    
    <!--
    #######################################################################################################################
    #    Service Requests (no need for this yet... but can remain)
    #######################################################################################################################
   -->
    <type type="servicenow.CreateServiceRequest" extends="servicenow.CreateTask" label="ServiceNow: Create Service Request">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <type type="servicenow.UpdateServiceRequest" extends="servicenow.UpdateTask" label="ServiceNow: Update Service Request">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <type type="servicenow.FindServiceRequestItemByTicket" extends="servicenow.FindRecordByTicket"  label="ServiceNow: Find Service Request">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <!--
    #######################################################################################################################
    #    Service Request Items (no need for this yet... but can remain)
    #######################################################################################################################
   -->
    <type type="servicenow.CreateRequestItem" extends="servicenow.CreateTask" label="ServiceNow: Create Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.UpdateRequestItem" extends="servicenow.UpdateTask"  label="ServiceNow: Update Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindRequestItemByTicket" extends="servicenow.FindRecordByTicket"  label="ServiceNow: Find Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>
    
    
      <!--
     #######################################################################################################################
     #    Need to be removed
     #######################################################################################################################
    --> 
    
    <!-- Request approval is done by setting the correct state. -->
    
    <type type="servicenow.RequestApproval" extends="servicenow.Base" label="ServiceNow: Change Request Approval" virtual="true">
        <property name="scriptLocation" default="servicenow/request_approval.py" hidden="true"/>
        <property name="shortDescription" category="input" label="Short Description" required="true"/>
        <property name="description" category="input" label="Description" required="true"/>        
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true" hidden="true"/>
        <property name="sysId" category="output"/>
        <property name="ticket" category="output"/>
    </type>
    
    <!-- Done by poll for status. -->
    
    <type type="servicenow.CheckChangeRequest" extends="servicenow.PollingCheckStatus" label="ServiceNow: Check Change Request" virtual="true">
        <property name="tableName" category="input" default="change_request" required="true" hidden="true"/>
        <property name="expectedStatus" category="input" default="Closed Complete,Closed Incomplete,Closed Skipped"
                  hidden="true"/>
        <property name="number" category="input" label="Number" required="true"/>
    </type>
    
    <!-- Done by standard base. -->
    
    <type type="servicenow.VirtualApplication" extends="xlrelease.PythonScript" virtual="true">
        <property name="iconLocation" default="servicenow/servicenow-icon.png" hidden="true"/>
        <property name="scriptLocation" default="servicenow/application/create_or_update_application.py" hidden="true"/>
        <property name="servicenowServer" category="input" label="Server" referenced-type="servicenow.Server" required="true"
                  kind="ci"/>
        <property name="username" category="input" required="false"/>
        <property name="password" password="true" category="input" required="false"/>
    </type>
    
    <type type="servicenow.Task" extends="xlrelease.PythonScript" virtual="true">
        <property name="iconLocation" default="servicenow/servicenow-icon.png" hidden="true"/>
        <property name="servicenowServer" category="input" label="Server" referenced-type="servicenow.Server" required="true"
                  kind="ci"/>
        <property name="username" category="input" required="false"/>
        <property name="password" password="true" category="input" required="false"/>
        <property name="data" category="output" kind="map_string_string"/>
    </type>
    
     <!--Record is default name for everything in servicenow, should not be used. -->
    
    <type type="servicenow.CreateRecord" extends="servicenow.Task" label="ServiceNow: Create Record" virtual="true">
        <property name="scriptLocation" default="servicenow/create_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="shortDescription" category="input" label="Short Description"/>
        <property name="description" category="input"  required="false"/>
        <property name="ciSysId" category="input" label="Configuration Item" description="Related CMDB Configuration Item Id" required="false"/>
        <property name="assignmentGroup" category="input" required="false"/>
        <property name="comments" category="input" label="Comments" required="false"/>
        <property name="additionalFields" category="input" required="false" kind="map_string_string"/>
        <property name="sysId" category="output"/>
        <property name="Ticket" category="output"/>
    </type>

    <type type="servicenow.UpdateRecord" extends="servicenow.Task" label="ServiceNow: Update Record" virtual="true">
        <property name="scriptLocation" default="servicenow/update_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="sysId" category="input" required="true"/>
        <property name="state" category="input" required="false"/>
        <property name="shortDescription" category="input" label="Short Description" required="false"/>
        <property name="description" category="input"  required="false"/>
        <property name="ciSysId" category="input" label="Configuration Item" description="Related CMDB Configuration Item Id" required="false"/>
        <property name="assignmentGroup" category="input" required="false"/>
        <property name="comments" category="input" label="Comments" required="false"/>
        <property name="additionalFields" category="input" required="false" kind="map_string_string"/>
    </type>
    
    <!-- Create and create new are exactly the same actions in ServiceNow, no use for double types. -->
    
    <type type="servicenow.CreateNewRecord" extends="servicenow.Task" label="ServiceNow: Create New Record" virtual="true">
        <property name="scriptLocation" default="servicenow/create_new_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="content" category="input" label="Request Content" required="true" size="large"/>
        <property name="sysId"   category="output"/>
        <property name="Ticket"  category="output"/>
    </type>

    <type type="servicenow.CreateNewIncident" extends="servicenow.CreateNewRecord" label="ServiceNow: Create New Incident" virtual="true">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>
    
    <type type="servicenow.CreateNewServiceRequest" extends="servicenow.CreateNewRecord" label="ServiceNow: Create New ServiceRequest" virtual="true">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>
    
    <type type="servicenow.CreateNewRequestItem" extends="servicenow.CreateNewRecord"  label="ServiceNow: Create New Request Item" virtual="true">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>
    
    <type type="servicenow.CreateNewChangeRequest" extends="servicenow.CreateNewRecord" label="ServiceNow: Create New ChangeRequest" virtual="true">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.ScheduleTask" extends="xlrelease.PythonScript" label="ServiceNow: Schedule Task" virtual="true">
        <property name="iconLocation" default="servicenow/xebialabs-icon.png" hidden="true"/>
        <property name="scriptLocation" default="servicenow/schedule_task.py" hidden="true"/>
        <property name="startField" category="input" label="Start Date Field" required="true"/>
        <property name="targetPhase" category="input" label="Phase to start release window" required="true"/>
        <property name="targetTask" category="input" label="Task to start release window" required="true"/>
        <property name="snFormat" category="input" label="ServiceNow date format" default="yyyy-MM-dd HH:mm:ss"/>
        <property name="snTimeZone" category="input" label="ServiceNow TimeZone" default="GMT" required="true"/>
        <property name="xlFormat" category="input" label="XLR date format" default="yyyy-MM-dd'T'HH:mm:ss'Z'"/>
        <property name="snData" category="input" label="Service Now Data Key-Value Map" kind="map_string_string"
                  required="true"/>
    </type>
</synthetic>