<?xml version='1.0' encoding='UTF-8'?>

<synthetic xsi:schemaLocation="http://www.xebialabs.com/deployit/synthetic synthetic.xsd"
           xmlns="http://www.xebialabs.com/deployit/synthetic" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

    <type type="servicenow.Server" label="ServiceNow: Server" extends="configuration.HttpConnection">
        <property name="scriptLocation" default="servicenow/check_connection.py" hidden="true"/>
        <property name="changeRecordTableName" label="Change Record Table Name (Required for Generate Release)"
                  required="true" default="change_request"/>
        <property name="changeTaskTableName" label="Change Task Table Name (Required for Generate Release)"
                  required="true" default="change_task"/>
        <property name="sysparmDisplayValue" label="Retrieve display value" required="true" default="True"
                  kind="boolean" description="If true returns display values for all of the fields"/>
        <property name="sysparmInputDisplayValue" label="Input values are display values" required="true" default="True"
                  kind="boolean" description="If true treats input values as display values"/>
        <property name="useOAuth" label="Use ServiceNow OAuth Resource Server"
                  description="Use OAuth instead of basic authentication" required="false" category="OAuth"
                  kind="boolean"/>
        <property name="oauthUsername" label="Username" description="Mandatory if OAuth is enabled" required="false"
                  category="OAuth"/>
        <property name="oauthPassword" label="Password" description="Mandatory if OAuth is enabled" required="false"
                  password="true" category="OAuth"/>
        <property name="clientId" label="Client Id" description="Mandatory if OAuth is enabled" required="false"
                  category="OAuth"/>
        <property name="clientSecret" label="Client Secret" description="Mandatory if OAuth is enabled" required="false"
                  password="true" category="OAuth"/>
    </type>

    <type type="servicenow.Task" extends="xlrelease.PythonScript" virtual="true">
        <property name="iconLocation" default="servicenow/servicenow-icon.png" hidden="true"/>
        <property name="servicenowServer" category="input" label="Server" referenced-type="servicenow.Server" required="true"
                  kind="ci"/>
        <property name="username" category="input" required="false"/>
        <property name="password" password="true" category="input" required="false"/>
        <property name="data" category="output" kind="map_string_string"/>
    </type>

    <type type="servicenow.CreateRecord" extends="servicenow.Task" label="ServiceNow: Create Record">
        <property name="scriptLocation" default="servicenow/create_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="shortDescription" category="input" label="Short Description"/>
        <property name="description" category="input"  required="false"/>
        <property name="ciSysId" category="input" label="Configuration Item" description="Related CMDB Configuration Item Id" required="false"/>
        <property name="assignmentGroup" category="input" required="false"/>
        <property name="comments" category="input" label="Comments" required="false"/>
        <property name="additionalFields" category="input" required="false" kind="map_string_string"/>
        <property name="sysId" category="output"/>
        <property name="Ticket" category="output"/>
    </type>

    <type type="servicenow.CreateNewRecord" extends="servicenow.Task" label="ServiceNow: Create New Record">
        <property name="scriptLocation" default="servicenow/create_new_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="content" category="input" label="Request Content" required="true" size="large"/>
        <property name="sysId"   category="output"/>
        <property name="Ticket"  category="output"/>
    </type>

    <type type="servicenow.UpdateRecord" extends="servicenow.Task" label="ServiceNow: Update Record">
        <property name="scriptLocation" default="servicenow/update_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="sysId" category="input" required="true"/>
        <property name="state" category="input" required="false"/>
        <property name="shortDescription" category="input" label="Short Description" required="false"/>
        <property name="description" category="input"  required="false"/>
        <property name="ciSysId" category="input" label="Configuration Item" description="Related CMDB Configuration Item Id" required="false"/>
        <property name="assignmentGroup" category="input" required="false"/>
        <property name="comments" category="input" label="Comments" required="false"/>
        <property name="additionalFields" category="input" required="false" kind="map_string_string"/>
    </type>

    <type type="servicenow.FindRecordByTicket" extends="servicenow.Task" label="ServiceNow: Find Record By Ticket">
        <property name="scriptLocation" default="servicenow/find_record.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="ticket" category="input" required="true"/>
        <property name="sysId" category="output"/>
    </type>


    <!--
       #######################################################################################################################
       #    Incident Requests
       #######################################################################################################################
   -->
    <type type="servicenow.CreateIncident" extends="servicenow.CreateRecord" label="ServiceNow: Create Incident">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.CreateNewIncident" extends="servicenow.CreateNewRecord" label="ServiceNow: Create New Incident">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.UpdateIncident" extends="servicenow.UpdateRecord" label="ServiceNow: Update Incident">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindIncidentByTicket" extends="servicenow.FindRecordByTicket" label="ServiceNow: Find Incident By Ticket">
        <property name="tableName" category="input" label="Table Name" default="incident" required="true"
                  hidden="true"/>
    </type>


    <!--
       #######################################################################################################################
       #    Tile
       #######################################################################################################################
   -->

    <type type="servicenow.ServiceNowQueryTile" label="ServiceNow: Service Now query tile" extends="xlrelease.Tile">
        <property name="uri" hidden="true" default="include/ServiceNowQueryTile/servicenow-query-summary-view.html"/>
        <property name="detailsUri" hidden="true"
                  default="include/ServiceNowQueryTile/servicenow-query-details-view.html"/>
        <property name="title" description="Tile title" default="ServiceNow tickets"/>
        <property name="embedded" kind="boolean" hidden="true" default="true"
                  required="false"/>
        <property category="input" name="servicenowServer" referenced-type="servicenow.Server" kind="ci" label="Server"
                  description="ServiceNow server id to connect to"/>
        <property category="input" name="username" required="false"
                  description="Overrides the username used to connect to the server"/>
        <property category="input" name="password" password="true" required="false"
                  description="Overrides the password used to connect to the server"/>
        <property category="input" name="authToken" required="false"
                  description="Overrides the auth token used to connect to the server" default="None" hidden="true"/>
        <property category="input" name="tableName" required="true" default="incident"
                  description="ServiceNow table name (in lower case) (for example problem, change_request etc) Default value: incident"/>
        <property category="input" name="query" required="false" size="large" description="ServiceNow query"/>
        <property category="input" name="detailsViewColumns" hidden="false" kind="map_string_string"
                  default="number:number,short_description:short_description,priority:priority,state:state,assigned_to:assigned_to.display_value"
                  description="Map of columns displayed in details view of tile. For a referenced type column, display_value should be in the value of key:value pair separated by . (eg. assigned_to:assigned_to.display_value)"/>
    </type>

    <!--
       #######################################################################################################################
       #    Service Requests
       #######################################################################################################################
   -->
    <type type="servicenow.CreateServiceRequest" extends="servicenow.CreateRecord" label="ServiceNow: Create ServiceRequest">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <type type="servicenow.CreateNewServiceRequest" extends="servicenow.CreateNewRecord" label="ServiceNow: Create New ServiceRequest">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <type type="servicenow.UpdateServiceRequest" extends="servicenow.UpdateRecord" label="ServiceNow: Update ServiceRequest">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <type type="servicenow.FindServiceRequestItemByTicket" extends="servicenow.FindRecordByTicket"  label="ServiceNow: Find ServiceRequest">
        <property name="tableName" category="input" default="sc_request" required="true" hidden="true"/>
    </type>

    <!--
       #######################################################################################################################
       #    Service Request Items
       #######################################################################################################################
   -->
    <type type="servicenow.CreateRequestItem" extends="servicenow.CreateRecord" label="ServiceNow: Create Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.CreateNewRequestItem" extends="servicenow.CreateNewRecord"  label="ServiceNow: Create New Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.UpdateRequestItem" extends="servicenow.UpdateRecord"  label="ServiceNow: Update Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindRequestItemByTicket" extends="servicenow.FindChangeRequestByTicket"  label="ServiceNow: Find Request Item">
        <property name="tableName" category="input" label="Table Name" default="sc_req_item" required="true"
                  hidden="true"/>
    </type>

    <!--
       #######################################################################################################################
       #    Change Request Tasks
       #######################################################################################################################
   -->
    <type type="servicenow.CreateTask" extends="servicenow.Task" label="ServiceNow: Create Task">
        <property name="scriptLocation" default="servicenow/create_task.py" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" required="true" default="change_task"
                  hidden="true"/>
        <property name="content" category="input" label="Task JSON Content" required="true" size="large"/>

        <property name="taskId" category="output"/>
        <property name="Task" category="output"/>
    </type>

    <type type="servicenow.UpdateTask" extends="servicenow.UpdateRecord" label="ServiceNow: Update Task">
        <property name="tableName" category="input" label="Table Name" default="change_task" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.CheckStatus" extends="servicenow.Task" label="ServiceNow: Check Status">
        <property name="scriptLocation" default="servicenow/check_status.py" hidden="true"/>
        <property name="statusField" category="input" label="Status Field" required="true"/>
        <property name="tableName" category="input" label="Table Name" required="true"/>
        <property name="sysId" category="input" label="System ID" required="true"/>

        <property name="status" category="output"/>
    </type>

    <!--
       #######################################################################################################################
       #    Change Requests
       #######################################################################################################################
   -->
    <type type="servicenow.CreateChangeRequest" extends="servicenow.CreateRecord" label="ServiceNow: Create ChangeRequest">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.CreateNewChangeRequest" extends="servicenow.CreateNewRecord" label="ServiceNow: Create New ChangeRequest">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.UpdateChangeRequest" extends="servicenow.UpdateRecord" label="ServiceNow: Update ChangeRequest">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindChangeRequestByTicket" extends="servicenow.FindRecordByTicket" label="ServiceNow: Find ChangeRequest">
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.FindChangeTaskByTaskId" extends="servicenow.FindRecordByTicket" label="ServiceNow: Find ChangeTask">
        <property name="tableName" category="input" label="Table Name" default="change_task" required="true"
                  hidden="true"/>
    </type>

    <type type="servicenow.RequestApproval" extends="servicenow.Task" label="ServiceNow: Request Approval">
        <property name="scriptLocation" default="servicenow/request_approval.py" hidden="true"/>

        <property name="shortDescription" category="input" label="Short Description" required="true"/>
        <property name="description" category="input" label="Description" required="true"/>
        <property name="content"
                  default="{&quot;short_description&quot;:&quot;%s&quot;,&quot;description&quot;:&quot;%s&quot;,&quot;category&quot;:&quot;XLRelease&quot;,&quot;u_supporting_service&quot;:&quot;Exchange Support&quot;,&quot;assignment_group&quot;:&quot;Global Software Change Group&quot;,&quot;justification&quot;:&quot;XLDeploy&quot;,&quot;requested_by_date&quot;:&quot;08-08-2014&quot;}"
                  category="input" hidden="true"/>
        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="sysId" category="output"/>
        <property name="ticket" category="output"/>
    </type>

    <type type="servicenow.PollingCheckStatus" extends="servicenow.Task" label="ServiceNow: Poll ChangeRequest Status">
        <property name="scriptLocation" default="servicenow/poll_change_request_status.py" hidden="true"/>

        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="false"/>
        <property name="sysId" category="input" label="System ID" required="true"/>
        <property name="pollInterval" category="input" kind="integer" label="Polling Interval" required="true"
                  default="30"/>
        <property name="statusField" category="input" label="Status Field" required="true" default="state"/>
        <property name="checkForStatus" category="input" label="Status Value to check for" required="true"/>
        <property name="status" category="output"/>
        <property name="ticket" category="output"/>
        <property name="data" category="output" kind="map_string_string"/>
    </type>

    <type type="servicenow.GetChangeRequest" extends="servicenow.Task" label="ServiceNow: Get ChangeRequest">
        <property name="scriptLocation" default="servicenow/get_change_request.py" hidden="true"/>

        <property name="tableName" category="input" default="change_request" required="true" hidden="true"/>
        <property name="number" category="input" label="Number" required="true"/>
        <property name="fieldNames" category="input" label="Field Names" required="true" kind="list_of_string"
                  description="List of field names to be displayed"/>
    </type>

    <type type="servicenow.CheckChangeRequest" extends="servicenow.Task" label="ServiceNow: Check ChangeRequest">
        <property name="scriptLocation" default="servicenow/check_change_request.py" hidden="true"/>

        <property name="tableName" category="input" default="change_request" required="true" hidden="true"/>
        <property name="expectedStatus" category="input" default="Closed Complete,Closed Incomplete,Closed Skipped"
                  hidden="true"/>

        <property name="number" category="input" label="Number" required="true"/>
    </type>

    <type type="servicenow.UpdateCMDB" extends="servicenow.Task" label="ServiceNow: Update CMDB">
        <property name="scriptLocation" default="servicenow/update_cmdb.py" hidden="true"/>
        <property name="tableName" category="input" default="cmdb_ci_appl" required="true" hidden="true"/>
        <property name="environment" category="input" required="true" label="Environment"/>
        <property name="applicationName" category="input" required="true" label="Application Name"/>
        <property name="company" category="input" required="true" label="Company"/>
        <property name="configAdminGroup" category="input" required="true" label="Config Admin Group"/>
        <property name="version" category="input" required="true" label="Version"/>
        <property name="virtualMachine" category="input" required="false" label="Virtual Machine"/>
        <property name="tomcat" category="input" required="false" label="Tomcat"/>
        <property name="mysql" category="input" required="false" label="MySql"/>
        <property name="cfSpace" category="input" required="false" label="CF Space"/>
        <property name="sysId" category="output"/>
    </type>

    <type type="servicenow.ScheduleTask" extends="xlrelease.PythonScript" label="ServiceNow: Schedule Task">
        <property name="iconLocation" default="servicenow/xebialabs-icon.png" hidden="true"/>
        <property name="scriptLocation" default="servicenow/schedule_task.py" hidden="true"/>
        <property name="startField" category="input" label="Start Date Field" required="true"/>
        <property name="targetPhase" category="input" label="Phase to start release window" required="true"/>
        <property name="targetTask" category="input" label="Task to start release window" required="true"/>
        <property name="snFormat" category="input" label="ServiceNow date format" default="yyyy-MM-dd HH:mm:ss"/>
        <property name="snTimeZone" category="input" label="ServiceNow TimeZone" default="GMT" required="true"/>
        <property name="xlFormat" category="input" label="XLR date format" default="yyyy-MM-dd'T'HH:mm:ss'Z'"/>
        <property name="snData" category="input" label="Service Now Data Key-Value Map" kind="map_string_string"
                  required="true"/>
    </type>

    <!--
        #######################################################################################################################
        #
        #                  Legacy Tasks that should be depricated in favor for more descriptive ones
        #
        #######################################################################################################################
    -->

    <type type="servicenow.CreateRequest" extends="servicenow.Task" label="ServiceNow: Create Request">
        <property name="scriptLocation" default="servicenow/create_record.py" hidden="true"/>

        <property name="tableName" category="input" label="Table Name" default="change_request" required="true"
                  hidden="true"/>
        <property name="shortDescription" category="input" label="Short Description" required="true"/>
        <property name="comments" category="input" label="Comments" required="true"/>

        <property name="sysId" category="output"/>
        <property name="Ticket" category="output"/>
    </type>


</synthetic>

